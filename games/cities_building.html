<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D City Building Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Three.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body class="bg-slate-900 min-h-screen flex flex-col items-center py-6">
  <a href="../index.html" class="mb-4 px-4 py-2 rounded-lg bg-cyan-700 text-white font-semibold hover:bg-cyan-500 transition">&larr; Back to Game Hub</a>
  <h1 class="text-3xl font-bold text-cyan-400 mb-4 drop-shadow">3D City Building Game</h1>
  <div id="toolbar" class="flex gap-4 mb-4">
    <button class="btn-building px-4 py-2 rounded-lg bg-slate-800 text-cyan-300 border-2 border-cyan-400 hover:bg-cyan-400 hover:text-slate-900 transition" data-type="house">ğŸ  House</button>
    <button class="btn-building px-4 py-2 rounded-lg bg-slate-800 text-yellow-300 border-2 border-yellow-400 hover:bg-yellow-400 hover:text-slate-900 transition" data-type="shop">ğŸª Shop</button>
    <button class="btn-building px-4 py-2 rounded-lg bg-slate-800 text-green-400 border-2 border-green-400 hover:bg-green-400 hover:text-slate-900 transition" data-type="tree">ğŸŒ² Tree</button>
    <button class="btn-building px-4 py-2 rounded-lg bg-slate-800 text-lime-400 border-2 border-lime-400 hover:bg-lime-400 hover:text-slate-900 transition" data-type="animal">ğŸ„ Animal</button>
    <button class="btn-building px-4 py-2 rounded-lg bg-slate-800 text-pink-300 border-2 border-pink-400 hover:bg-pink-400 hover:text-slate-900 transition" data-type="clear">âŒ Clear</button>
  </div>
  <div class="rounded-lg shadow-lg border-4 border-cyan-400 bg-slate-800" style="width: 600px; height: 600px;">
    <div id="threejs-canvas" style="width: 600px; height: 600px;"></div>
  </div>
  <script>
    // --- Three.js Setup ---
    let scene, camera, renderer, raycaster, mouse;
    let gridSize = 10;
    let cellSize = 5;
    let gridObjects = Array.from({length: gridSize}, () => Array(gridSize).fill(null));
    let selectedType = 'house';
    let animalMeshes = [];

    // Scene
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x181f2a);

    // Camera
    camera = new THREE.PerspectiveCamera(60, 1, 0.1, 1000);
    camera.position.set(gridSize * cellSize / 2, 30, gridSize * cellSize * 0.9);
    camera.lookAt(gridSize * cellSize / 2, 0, gridSize * cellSize / 2);

    // Renderer
    renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(600, 600);
    document.getElementById('threejs-canvas').appendChild(renderer.domElement);

    // Lights
    const ambient = new THREE.AmbientLight(0xffffff, 0.7);
    scene.add(ambient);
    const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
    dirLight.position.set(20, 40, 20);
    scene.add(dirLight);

    // Grid Helper
    const gridHelper = new THREE.GridHelper(gridSize * cellSize, gridSize, 0x4cffc8, 0x26352c);
    scene.add(gridHelper);

    // Floor
    const floorGeo = new THREE.PlaneGeometry(gridSize * cellSize, gridSize * cellSize);
    const floorMat = new THREE.MeshStandardMaterial({color: 0x26352c});
    const floor = new THREE.Mesh(floorGeo, floorMat);
    floor.rotation.x = -Math.PI/2;
    scene.add(floor);

    // Raycaster for mouse picking
    raycaster = new THREE.Raycaster();
    mouse = new THREE.Vector2();

    // --- Toolbar Logic ---
    document.querySelectorAll('.btn-building').forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll('.btn-building').forEach(b => b.classList.remove('ring-4', 'ring-cyan-400', 'ring-yellow-400', 'ring-green-400', 'ring-lime-400', 'ring-pink-400'));
        if (btn.dataset.type === 'clear') btn.classList.add('ring-4', 'ring-pink-400');
        else if (btn.dataset.type === 'shop') btn.classList.add('ring-4', 'ring-yellow-400');
        else if (btn.dataset.type === 'tree') btn.classList.add('ring-4', 'ring-green-400');
        else if (btn.dataset.type === 'animal') btn.classList.add('ring-4', 'ring-lime-400');
        else btn.classList.add('ring-4', 'ring-cyan-400');
        selectedType = btn.dataset.type;
      };
    });
    document.querySelector('.btn-building[data-type="house"]').classList.add('ring-4', 'ring-cyan-400');

    // --- Place/Remove Objects ---
    renderer.domElement.addEventListener('click', (event) => {
      const rect = renderer.domElement.getBoundingClientRect();
      mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
      mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObject(floor);
      if (intersects.length > 0) {
        const point = intersects[0].point;
        const x = Math.floor(point.x / cellSize);
        const z = Math.floor(point.z / cellSize);
        if (x >= 0 && x < gridSize && z >= 0 && z < gridSize) {
          // Remove old object if present
          if (gridObjects[z][x]) {
            scene.remove(gridObjects[z][x]);
            gridObjects[z][x] = null;
          }
          // Place new object
          if (selectedType !== 'clear') {
            let mesh;
            if (selectedType === 'house') {
              mesh = createHouse();
            } else if (selectedType === 'shop') {
              mesh = createShop();
            } else if (selectedType === 'tree') {
              mesh = createTree();
            } else if (selectedType === 'animal') {
              mesh = createAnimal();
              animalMeshes.push(mesh);
            }
            if (mesh) {
              mesh.position.set(x * cellSize + cellSize/2, 0, z * cellSize + cellSize/2);
              scene.add(mesh);
              gridObjects[z][x] = mesh;
            }
          }
        }
      }
    });

    // --- 3D Models ---
    function createHouse() {
      const group = new THREE.Group();
      const base = new THREE.Mesh(
        new THREE.BoxGeometry(3, 2, 3),
        new THREE.MeshStandardMaterial({color: 0x38bdf8})
      );
      base.position.y = 1;
      group.add(base);
      const roof = new THREE.Mesh(
        new THREE.ConeGeometry(2.2, 1, 4),
        new THREE.MeshStandardMaterial({color: 0xb91c1c})
      );
      roof.position.y = 2.5;
      roof.rotation.y = Math.PI/4;
      group.add(roof);
      return group;
    }
    function createShop() {
      const group = new THREE.Group();
      const base = new THREE.Mesh(
        new THREE.BoxGeometry(3, 1.5, 3),
        new THREE.MeshStandardMaterial({color: 0xfde047})
      );
      base.position.y = 0.75;
      group.add(base);
      const awning = new THREE.Mesh(
        new THREE.BoxGeometry(3, 0.3, 1.2),
        new THREE.MeshStandardMaterial({color: 0xb91c1c})
      );
      awning.position.y = 1.3;
      awning.position.z = 1.1;
      group.add(awning);
      return group;
    }
    function createTree() {
      const group = new THREE.Group();
      const trunk = new THREE.Mesh(
        new THREE.CylinderGeometry(0.3, 0.3, 1.2, 8),
        new THREE.MeshStandardMaterial({color: 0x8b5e3c})
      );
      trunk.position.y = 0.6;
      group.add(trunk);
      const leaves = new THREE.Mesh(
        new THREE.SphereGeometry(1, 12, 12),
        new THREE.MeshStandardMaterial({color: 0x10b981})
      );
      leaves.position.y = 1.7;
      group.add(leaves);
      return group;
    }
    function createAnimal() {
      const group = new THREE.Group();
      const body = new THREE.Mesh(
        new THREE.BoxGeometry(1.2, 0.7, 0.5),
        new THREE.MeshStandardMaterial({color: 0xffffff})
      );
      body.position.y = 0.35;
      group.add(body);
      const head = new THREE.Mesh(
        new THREE.BoxGeometry(0.4, 0.4, 0.4),
        new THREE.MeshStandardMaterial({color: 0xcccccc})
      );
      head.position.set(0.7, 0.6, 0);
      group.add(head);
      return group;
    }

    // --- Animate Animals ---
    function animateAnimals() {
      animalMeshes.forEach(mesh => {
        mesh.position.x += Math.sin(Date.now() * 0.001 + mesh.position.z) * 0.01;
        mesh.position.z += Math.cos(Date.now() * 0.001 + mesh.position.x) * 0.01;
      });
    }

    // --- Render Loop ---
    function animate() {
      requestAnimationFrame(animate);
      animateAnimals();
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>